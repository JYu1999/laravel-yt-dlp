---
stepsCompleted: ['step-01-init', 'step-02-discovery', 'step-03-success', 'step-04-journeys', 'step-05-domain', 'step-06-innovation', 'step-07-project-type', 'step-08-scoping', 'step-01b-continue', 'step-09-functional', 'step-10-nonfunctional', 'step-11-polish']
inputDocuments: []
briefCount: 0
researchCount: 0
brainstormingCount: 0
projectDocsCount: 0
workflowType: 'prd'
classification:
  projectType: 'web_app'
  domain: 'general'
  complexity: 'medium'
  projectContext: 'greenfield'
---

# Product Requirements Document - laravel-yt-dlp

**Author:** jyu
**Date:** 2026-01-13

## Success Criteria

### User Success

**啊哈时刻：**
- 第一次成功下载视频的那一刻
- 发现不用再查 yt-dlp 文档和记忆复杂命令

**体验标准：**
- 从贴上 YouTube 链接到下载完成：1-3 分钟
- 第一次使用就成功 - 这是关键的成功门槛
- 一次性解决问题，无需反复尝试

**情绪目标：**
用户使用后感到轻松、满意 - 不再为技术细节烦恼，专注于获取想要的内容。

**关键成功因素：**
第一次使用的成功率至关重要。如果首次体验失败，用户可能不会再回来。

### Business Success

**核心目标：**
每月净利 10,000 新台币（扣除服务器成本后）

**用户增长里程碑：**
- **3 个月：** 100 个活跃用户
- **12 个月：** 1,000 个活跃用户

**用户策略：**
双管齐下的增长策略：
- **留存：** 注册用户持续回来使用
- **获客：** 新用户不断发现和尝试工具

**变现模式：**
Google AdSense 广告集成，最大化广告展示（非管理员用户）

**成功评估标准：**
6 个月后回顾，如果达到每月 10,000 新台币净利，项目即为成功。

### Technical Success

**稳定性标准：**
- 下载成功率 ≥ 95%
- 可接受的失败场景：
  - YouTube 链接本身有问题
  - 不支持的视频格式或受限视频
  - 网络异常

**性能目标：**
- 下载速度：10MB/s
- 视频信息展示响应：≤ 5 秒
- 并发控制：
  - 每用户同时只能下载 1 部视频
  - 系统最多同时处理 10 部下载

**可维护性：**
- yt-dlp 工具：有需要时更新（如功能失效或重大改进）
- 紧急修复：YouTube API 变更导致功能失效时，1 天内修复

**技术架构：**
- 全栈 Docker 化：本地开发和生产环境一致
- Laravel + yt-dlp 集成
- 流式下载（不在服务器存储视频）

### Measurable Outcomes

**用户体验指标：**
- 首次下载成功率 > 90%
- 平均完成时间 < 3 分钟（从贴链接到下载完成）
- 视频信息响应 < 5 秒

**技术指标：**
- 系统整体下载成功率 ≥ 95%
- 系统可用性 > 99%（排除计划维护）

**业务指标：**
- 3 个月：100 活跃用户
- 6 个月：月净利 10,000 新台币
- 12 个月：1,000 活跃用户

## Product Scope

### MVP - Minimum Viable Product

**核心功能（Launch 必须完成）：**

1. **用户系统**
   - 用户注册/登录
   - 速率限制：匿名用户 3 部，注册用户每小时 5 部、每天 10 部
   - 管理员白名单（无广告特权）

2. **视频下载核心流程**
   - YouTube 链接输入和验证
   - 视频信息展示（标题、时长、文件大小）
   - 视频格式选择（MP4 / MOV）
   - 最高画质 + 最好音质自动选择

3. **字幕功能**
   - 可选字幕下载
   - 字幕语言选择

4. **下载体验**
   - 实时下载进度条
   - 流式传输（不在服务器存储）

5. **错误处理**
   - 链接无效提示
   - 不支持视频类型提示
   - 网络异常处理

6. **变现**
   - Google AdSense 广告集成
   - 广告最大化展示（非管理员用户）

7. **技术基础设施**
   - Docker 开发和生产环境
   - Laravel 框架基础
   - yt-dlp 集成

### Growth Features (Post-MVP)

**Launch 后的增长功能：**

- **下载历史记录** - 让用户查看过去的下载
- **批量下载** - 一次提交多个 YouTube 链接
- **下载队列管理** - 用户可以查看和管理队列
- **用户统计仪表板** - 显示个人使用情况和限额
- **更多格式支持** - WebM、MKV 等其他视频格式
- **下载速度优化** - 多线程或更快的处理

### Vision (Future)

**长期发展方向：**

- **视频预览功能** - 下载前预览视频片段
- **用户收藏夹** - 保存常看的频道或播放列表
- **分享功能** - 分享下载链接或列表
- **AI 内容分析集成** - 自动生成视频摘要和笔记（契合你用 AI 分析视频内容的需求）
- **云存储集成** - 直接保存到 Google Drive、Dropbox 等
- **社区功能** - 用户可以分享和推荐视频
- **播放列表批量下载** - 一键下载整个 YouTube 播放列表
- **音频提取** - 仅下载音频（MP3、AAC）

## User Journeys

### Journey 1: 小陈 - 首次访问的普通用户（匿名用户）

**背景故事：**
小陈是一位 28 岁的产品经理，周末晚上在家准备下周的产品提案。他在 YouTube 上看到一个非常棒的产品设计教学视频，想要下载下来反复学习，也想把字幕导出来用 AI 做笔记。他以前试过用 yt-dlp 命令行工具，但每次都要查文档，命令参数一大堆，试了三次才成功，非常 frustrating。现在他真的不想再折腾了。

**旅程开始：**

**场景 1 - 发现（晚上 10:30）**
小陈在 Google 搜索"youtube 下载工具 简单"，看到网站出现在搜索结果中。标题写着"YouTube 视频下载 - 简单易用，无需命令行"。

他点进去，看到一个干净简洁的页面：
- 一个大大的输入框写着"贴上 YouTube 链接"
- 下方写着"匿名用户可免费下载 3 部视频"
- 旁边有 Google AdSense 广告

*情绪：谨慎乐观（"又一个下载工具？希望这次别再折腾了..."）*

**场景 2 - 尝试（10:32）**
小陈复制 YouTube 链接，贴到输入框，按下确认。

**3 秒后**，页面显示视频信息：
- 标题："产品设计思维实战教程"
- 时长：25:30
- 文件大小：约 450MB
- 可选格式：MP4 / MOV
- 字幕选项：☑️ 下载字幕 → 语言：中文（繁体）/ 英文 / 中文（自动生成）

*情绪：惊喜（"哇，这么快就识别出来了！而且还能看到文件大小和字幕选项！"）*

**场景 3 - 选择（10:33）**
小陈选择：
- 格式：MP4
- 字幕：勾选，选择"中文（繁体）"

点击"开始下载"按钮。

**场景 4 - 等待（10:33-10:35）**
页面出现进度条：
- "正在处理视频... 25%"
- "下载中... 60%"
- 估计剩余时间：1 分钟

*情绪：放松（"终于不用在终端里敲命令了，进度条看起来很靠谱"）*

**场景 5 - 成功（10:35）**
2 分钟后，下载完成！
- 视频文件自动下载到他的电脑
- 字幕文件（.srt）也一起下载了
- 页面提示："下载完成！您今天还可以下载 2 部视频。注册后每天可下载 10 部。"

*情绪：满意 + 惊喜（"太简单了！2 分钟搞定，字幕也有，完美！"）*

**场景 6 - 决策时刻（10:36）**
小陈看到注册提示。他想："我可能会经常用这个工具..."

他看到注册很简单（邮箱 + 密码），决定注册。

**结局：**
小陈成功下载了他需要的视频和字幕，用 AI 生成了笔记，周末提案准备得很顺利。下周他又用这个工具下载了两个竞品分析的视频。

**他的新现实：** 从"每次下载都要折腾半小时查文档"变成"2 分钟轻松搞定"。

---

### Journey 2: Lisa - 注册用户的日常使用

**背景故事：**
Lisa 是一位 32 岁的内容创作者和自由译者，经常需要从 YouTube 下载国外的教学视频和演讲内容，提取字幕来翻译，或者用 AI 分析内容做研究。两周前她第一次使用了这个工具（就像小陈一样），用完 3 部免费配额后立刻就注册了。现在她每周会下载 5-8 个视频。

**旅程开始：**

**场景 1 - 回访（周二下午 2:15）**
Lisa 打开浏览器，直接输入网站网址（已经加入书签）。

登录后，她看到：
- 欢迎回来，Lisa！
- 今日下载配额：10 部（剩余 10 部）
- 每小时配额：5 部（剩余 5 部）
- 页面有 Google AdSense 广告（侧边栏和顶部）

*情绪：熟悉、放松（"我的工作好帮手"）*

**场景 2 - 连续下载（2:16-2:30）**
Lisa 需要下载 4 个关于 AI 应用的演讲视频，准备写一篇研究文章。

她依次贴上 4 个 YouTube 链接：
1. 第 1 个视频 - 选择 MP4 + 英文字幕 → 下载成功（2分钟）
2. 第 2 个视频 - 选择 MP4 + 英文字幕 → 下载成功（3分钟）
3. 第 3 个视频 - 选择 MOV + 英文+中文字幕 → 下载成功（2分钟）
4. 第 4 个视频 - 贴上链接后点击开始下载

页面显示配额信息更新：
- 今日下载配额：6/10 部已使用
- 每小时配额：4/5 部已使用

*情绪：高效、满意（"批量处理很顺利，配额显示很清楚"）*

**场景 3 - 遇到速率限制（晚上 8:45）**
当天晚上，Lisa 又找到了 6 个相关视频想要下载。

她下载了第 6、7、8、9、10 部视频后，尝试下载第 11 部时：

**页面提示：**
"您今天的下载配额已用完（10/10）。明天凌晨 0:00 重置配额。"

*情绪：轻微失望，但理解（"哦对，有限制。不过 10 部也够用了，明天再下载吧。"）*

**场景 4 - 第二天继续（周三上午 9:30）**
Lisa 第二天登录，看到配额已重置：
- 今日下载配额：0/10 部已使用
- 每小时配额：0/5 部已使用

她顺利下载了昨天没下载完的视频。

*情绪：满意（"系统很稳定，配额管理也很合理"）*

**场景 5 - 推荐给朋友（周五下午）**
Lisa 在工作群组里分享了这个工具的链接：
"推荐一个超好用的 YouTube 下载工具，不用命令行，有字幕选择，速度也快！"

**结局：**
Lisa 持续使用这个工具两个多月了。虽然有广告，但她觉得可以接受，因为工具真的帮她节省了大量时间。每月她大约下载 30-40 个视频，从来没有遇到过技术问题。

**她的新现实：** 从"每次下载要折腾命令行，浪费工作时间"变成"可靠的日常工作工具，让她专注于内容创作"。

---

### Journey 3: jyu - 管理员的运营与维护

**背景故事：**
jyu 是这个工具的创建者和唯一管理员。白天他有全职工作，晚上和周末会检查网站运营状况。网站上线 2 个月了，用户数量稳定增长，但偶尔会遇到滥用问题。

**旅程开始：**

**场景 1 - 日常使用（周六下午 3:00）**
jyu 自己也需要下载 YouTube 视频用于 AI 分析和做笔记。

他访问网站，使用管理员账号登录后：
- **页面干净无广告**（他的特权）
- 没有下载配额限制
- 界面和普通用户一样简洁

他贴上链接，选择 MP4 + 中文字幕，2 分钟后下载完成。

*情绪：满意（"自己做的工具，自己用起来最爽"）*

**场景 2 - 检查系统状况（周六晚上 8:30）**
jyu 吃完晚饭，习惯性地打开管理后台检查今天的运营状况。

**管理后台仪表板显示：**

**今日统计：**
- 总下载次数：347 次
- 新注册用户：12 人
- 活跃用户：89 人
- 匿名下载：156 次
- 注册用户下载：191 次

**系统状态：**
- 服务器 CPU：45%
- 内存使用：2.1GB / 4GB
- 当前下载队列：3 个任务进行中
- yt-dlp 版本：2025.12.15（最新）

**收入预估：**
- 今日广告展示：2,340 次
- 预估收入：约 320 新台币

*情绪：满意（"数据看起来不错，系统运行稳定"）*

**场景 3 - 发现异常（周日下午 2:15）**
jyu 收到系统自动发送的警告邮件：
"警告：用户 ID 1847 在过去 1 小时内尝试下载 28 次，疑似滥用。"

他登录管理后台，查看该用户的详细记录：

**用户详情页：**
- 用户名：test_bot_2024
- 注册时间：今天上午 10:22
- IP 地址：203.145.23.88
- User-Agent：Python-urllib/3.11（**非浏览器请求！**）
- 下载记录：
  - 10:30 - 下载成功（5 次）
  - 10:35 - 触发每小时限制
  - 10:36 - 继续尝试下载（被拦截 23 次）
  - 11:40 - 配额重置后又下载 5 次
  - 11:45 - 再次触发限制

*情绪：警觉 + 烦恼（"机器人在刷接口，得处理掉"）*

**他的行动：**

1. **封锁用户**
   - 点击"封锁用户"按钮
   - 理由：自动化脚本滥用
   - 该用户账号立即被禁用

2. **封锁 IP**
   - 点击"封锁 IP：203.145.23.88"
   - 该 IP 30 天内无法访问网站

3. **启用非浏览器请求拦截**
   - 进入"安全设置"
   - 勾选"阻止非浏览器请求（User-Agent 检测）"
   - 保存设置

系统提示："设置已生效。非浏览器请求将被自动拦截。"

*情绪：松了一口气（"处理完毕，系统更安全了"）*

**场景 4 - 应对 YouTube API 变更（某个周三早上 7:30）**
jyu 起床后习惯性地看手机，发现 5 封用户反馈邮件：
"下载失败，显示错误：无法获取视频信息"

他意识到可能是 YouTube 又改 API 了。立即打开电脑：

1. **检查错误日志**（管理后台）：
   - 过去 12 小时：156 次下载失败
   - 错误信息：yt-dlp 返回 403 错误

2. **本地测试**：
   - Docker 环境启动
   - 手动运行 yt-dlp 测试 → 确认是 YouTube 反爬虫更新

3. **紧急修复**：
   - 更新 yt-dlp 到最新版本
   - 修改 Docker 配置
   - 本地测试通过

4. **部署更新**：
   - 推送到生产环境
   - 5 分钟后部署完成
   - 测试下载 → 成功！

5. **管理后台发布公告**（临时开放下载）：
   "系统已修复，如之前下载失败，请重试。今日因系统维护，所有用户额外获得 3 次下载配额。"
   - 点击"临时开放：所有用户 +3 配额"
   - 24 小时后自动失效

*情绪：紧张 → 满意（"1 小时内修复完成，用户体验影响降到最低"）*

**场景 5 - 月度回顾（月底晚上 10:00）**
jyu 打开管理后台查看本月运营数据：

**本月统计（1-31 日）：**
- 总下载次数：8,943 次
- 新注册用户：127 人
- 月活跃用户：312 人
- 广告展示：52,340 次
- **月收入：9,870 新台币**（扣除服务器成本 1,200 后，净利 8,670）

*情绪：有点失望但还算满意（"还差一点点就到 10,000 目标了，但成长趋势不错"）*

他记录下来：
- 下个月目标：优化 SEO，吸引更多自然流量
- 考虑添加下载历史功能，提高用户粘性

**结局：**
jyu 建立了一个稳定运营的工具，每月花 2-3 小时维护就能保持系统健康运行。虽然还没达到 10,000 净利目标，但方向是对的。

**他的新现实：** 从"一个想法"变成"一个真正运营的产品，帮助数百人，同时创造被动收入"。

---

### Journey Requirements Summary

这些旅程揭示了以下能力需求：

#### 核心下载功能
- YouTube 链接输入和快速验证（< 5 秒）
- 视频信息展示（标题、时长、文件大小）
- 格式选择（MP4/MOV）
- 字幕下载和语言选择
- 实时进度条
- 流式下载（不存储）
- 错误处理和友好提示

#### 用户系统
- 用户注册/登录
- 匿名用户配额（3 部）
- 注册用户配额（每小时 5 部、每天 10 部）
- 配额实时显示和追踪
- 配额重置机制（每天 0:00）
- 管理员白名单（无广告、无配额）

#### 广告系统
- Google AdSense 集成
- 根据用户角色显示/隐藏广告
- 广告位置布局（侧边栏、顶部）

#### 管理后台

**仪表板：**
- 实时统计（下载次数、用户数、活跃度）
- 系统状态（CPU、内存、队列）
- 收入预估和报表

**用户管理：**
- 用户详情查看（下载历史、IP、User-Agent）
- 封锁用户账号
- 封锁 IP（带时限）

**安全管理：**
- 非浏览器请求拦截
- 异常行为警报（邮件通知）
- 滥用检测

**运营工具：**
- 临时开放下载配额
- 系统公告发布
- 数据报表（日/周/月）

**维护工具：**
- 错误日志查看
- yt-dlp 版本管理
- 系统配置管理

#### 技术基础设施
- Docker 开发和生产环境
- Laravel 框架
- yt-dlp 集成
- 并发控制（每用户 1 部，系统 10 部）
- 错误日志系统
- 邮件通知系统

## Domain-Specific Requirements

### 1. 法律合规与风险管理

**法律风险认知：**
- YouTube 服务条款（TOS）明确禁止未经授权下载视频
- 产品存在法律灰色地带，服务可能随时被迫关闭
- **风险接受：** 项目所有者理解并接受此风险

**必要的法律保护措施（MVP 必须完成）：**
- **免责声明：** 网站首页和下载页面显示免责声明
  - 声明内容："本工具仅供个人学习和研究使用，用户需自行承担使用责任。请遵守当地法律法规和 YouTube 服务条款。"
- **用户协议：** 用户注册时必须同意使用条款
  - 明确用户自负版权和法律责任
  - 禁止商业用途声明
  - 保留随时终止服务的权利
- **使用限制说明：** 建议用户仅下载个人、教育、研究用途的内容

**市场与语言：**
- 主要市场：中文圈（台湾、中国大陆、香港、新加坡）
- 长期考虑：多国语系支持（英文、日文等）
- 不主动限制任何市场，但不为特定市场定制合规措施

**内容限制策略：**
- 不主动限制任何类型内容的下载
- 由用户自行判断和承担责任

---

### 2. 技术依赖风险与应对

**关键外部依赖：**

本产品高度依赖两个外部因素：
1. **YouTube** - 视频来源和反爬虫机制
2. **yt-dlp** - 开源下载工具

**风险场景与应对策略：**

**场景 1：YouTube 更新反爬虫机制**
- **监控机制：** 管理后台显示下载失败率统计
- **应对流程：**
  - 检查 yt-dlp 社区是否有更新
  - 手动验证新版本后更新
  - 通常 yt-dlp 社区响应很快（1-3 天）
- **用户沟通：** 如失败率超过 30%，在网站首页显示维护公告

**场景 2：YouTube 大规模封锁 yt-dlp**
- **应对方案：** 暂时停机或永久停止服务
- **无备用方案：** 不投入资源开发替代下载引擎
- **风险接受：** 这是可能终止项目的场景

**场景 3：YouTube 封锁服务器 IP**
- **预防措施：** 从一开始就通过 proxy 池或 VPN 分散请求（推荐）
- **应急方案：** 更换 VPS 提供商或 IP 地址
- **长期方案：** 考虑使用 rotating proxy 服务

**yt-dlp 版本管理策略：**
- **更新方式：** 手动验证后更新（非自动更新）
- **验证流程：**
  1. 本地 Docker 环境测试新版本
  2. 测试 5-10 个不同类型的视频下载
  3. 验证通过后部署到生产环境
- **更新频率：**
  - 主动更新：每月检查一次新版本
  - 被动更新：发现下载失败率上升时立即检查更新

**不使用 YouTube 官方 API：**
- 官方 API 不支持下载功能
- 仅依赖 yt-dlp 获取视频信息和下载

---

### 3. 数据隐私与安全

**用户密码安全：**
- 使用 **bcrypt** 算法存储密码（Laravel 默认）
- 密码最低要求：8 个字符（无复杂度要求，保持简单）

**数据保留策略：**

本服务采用有限数据保留策略，平衡用户隐私与系统运营需求：

| 数据类型 | 保留期限 | 清理规则 | 例外情况 |
|---------|---------|---------|---------|
| **IP 地址记录** | 30 天 | 自动清理 | 被封锁 IP 保留封锁期间 + 30 天 |
| **下载记录（匿名用户）** | 24 小时 | 自动清理 | 无 |
| **下载记录（注册用户）** | 90 天 | 自动清理 | 无 |
| **下载历史（post-MVP）** | 6-12 个月 | 自动清理或用户手动删除 | 无 |
| **用户账号信息** | 账号存在期间 | 用户可删除账号（post-MVP） | 被封锁账号保留 1 年后清理 |
| **错误日志** | 30 天 | 自动清理 | 无 |

**数据删除功能（post-MVP）：**
- 用户可以删除自己的账号和所有相关数据
- 删除后 24 小时内完全清除（包括备份）

**隐私政策与用户协议：**
- **MVP 阶段：** 无独立隐私政策文档
- **简化用户协议：** 注册时的使用条款（包含基本数据使用说明）
- **post-MVP：** 如用户增长快速，考虑添加独立隐私政策页面

**基本安全措施：**
- HTTPS 加密传输（必须）
- CSRF 保护（Laravel 默认）
- SQL 注入防护（Laravel ORM）
- XSS 防护（输入验证和输出转义）

**不遵守 GDPR/CCPA：**
- 不主动针对欧美市场
- 不承诺 GDPR 合规
- 如未来有合规需求，考虑地理围栏或添加合规功能

---

### 4. 变现策略与风险管理

**主要变现策略：Plan C - 混合模式**

本产品采用混合变现模式，降低单一收入来源风险：

**Plan A：Google AdSense（主要收入来源）**
- **目标：** 每月 10,000 新台币净利
- **广告位置：**
  - 网站顶部横幅
  - 侧边栏
  - 下载页面（非阻断式）
- **显示规则：** 仅对非管理员用户显示
- **用户体验：** 广告可以影响体验（接受干扰以最大化展示）

**风险评估：**
- **高风险：** YouTube 下载工具可能违反 AdSense 内容政策
- **可能结果：**
  - 最好情况：AdSense 批准并正常运营
  - 中等情况：初期批准，后期因违规被封号
  - 最坏情况：申请时就被拒绝
- **应对：** 申请时如实描述产品功能，不隐瞒下载性质

**Plan B：替代广告网络（备用方案）**

如果 AdSense 被拒绝或封号，转向低门槛广告网络：
- **候选网络：**
  - Media.net
  - PropellerAds
  - A-Ads（比特币广告网络）
  - AdSterra
- **预期收益：** 比 AdSense 低 40-60%，但内容政策更宽松
- **实施时机：** AdSense 失败后 1-2 周内切换

**Plan C：可选捐赠（辅助收入）**

在 post-MVP 或广告收益不足时启动：
- **平台选择：**
  - Buy Me a Coffee（推荐，简单易用）
  - Patreon（订阅制）
  - 直接加密货币捐赠（比特币、以太坊）
- **展示方式：**
  - 网站底部"支持我们"按钮（不显眼）
  - 成功下载后的"感谢"页面提示
  - 不强制或阻断式请求捐赠
- **激励机制（可选）：**
  - 捐赠者获得无广告体验（需要账号关联）
  - 捐赠者获得更高下载配额

**其他 YouTube 下载工具的变现观察：**
- 大多数使用低质量广告网络或"灰色"广告
- 部分工具通过订阅会员制变现（$2-5/月）
- 部分工具通过联盟营销（推荐 VPN、云存储）
- 少数工具依靠捐赠维持

**变现策略灵活性：**
- MVP 专注 AdSense
- 根据实际运营情况调整 Plan B/C 的启动时机
- 不排除未来探索其他模式（如联盟营销）

---

### 5. 反滥用与服务稳定性

**滥用威胁识别：**

主要滥用场景：
1. **机器人批量下载** - 自动化脚本绕过限制
2. **批量注册账号** - 用多个邮箱突破配额限制
3. **恶意流量攻击** - DDoS 或高频请求

**MVP 反滥用措施（必须实现）：**

**1. 速率限制（Rate Limiting）**
- **匿名用户：** 每天 3 部视频
- **注册用户：** 每小时 5 部，每天 10 部
- **IP 层限制：** 同一 IP 每小时最多 20 次请求（包含所有用户）
- **并发限制：** 每用户同时只能下载 1 部视频，系统最多同时处理 10 部

**2. 邮箱验证（Email Verification）**
- **注册流程：** 用户注册后必须完成邮箱验证才能使用服务
- **验证期限：** 24 小时内完成，否则账号自动删除
- **重发限制：** 同一邮箱 10 分钟内最多重发 3 次验证邮件

**3. IP 关联限制**
- **检测规则：** 同一 IP 地址 24 小时内最多注册 3 个账号
- **触发行为：** 超过限制后，该 IP 无法继续注册（显示"请稍后再试"）
- **解除时间：** 24 小时后自动解除

**4. CAPTCHA 验证**
- **触发场景：**
  - 用户注册时（必须）
  - 下载次数接近配额时（可选）
  - 检测到异常行为时（如短时间多次失败尝试）
- **技术选择：** Google reCAPTCHA v2 或 hCaptcha
- **用户体验：** 仅在必要时触发，避免过度干扰

**5. User-Agent 检测**
- **拦截规则：** 阻止非浏览器请求（Python、curl、wget 等）
- **白名单：** 仅允许主流浏览器 User-Agent
- **绕过检测：** 管理员可在后台临时关闭此功能（用于测试）

**6. 一次性邮箱检测（post-MVP 考虑）**
- **检测方式：** 使用第三方 API 检测临时邮箱服务
- **处理方式：** 拒绝一次性邮箱注册或要求额外验证

**异常流量监控（管理后台功能）：**

**实时监控指标：**
- 当前活跃用户数
- 当前下载队列长度
- 过去 1 小时的下载成功率
- 过去 1 小时的错误率（按类型分类）
- 过去 1 小时的 IP 访问频率 Top 10

**警报机制：**
- **邮件警报触发条件：**
  - 单用户 1 小时内尝试下载超过 15 次（疑似滥用）
  - 系统下载失败率超过 30%（可能 YouTube 更新或服务异常）
  - 单 IP 1 小时内请求超过 100 次（疑似攻击）
  - 服务器 CPU 或内存使用率超过 80%
- **警报接收：** 管理员邮箱
- **响应时间预期：** 白天 1 小时内，晚上 12 小时内

**IP 封锁与管理：**

**封锁触发条件：**
- 手动封锁：管理员在后台手动封锁
- 自动封锁：单 IP 1 小时内触发 5 次 CAPTCHA 验证失败

**封锁期限：**
- 临时封锁：24 小时（自动解除）
- 永久封锁：需要手动解除

**封锁绕过应对：**
- 如发现用户通过 VPN 或代理绕过封锁，考虑升级检测机制
- 如滥用严重，考虑要求手机号验证（post-MVP）

**服务稳定性保障：**

**YouTube IP 封锁应对方案：**
- **预防：** 从一开始就使用 proxy 池或 VPN 服务分散请求
- **应急：**
  - 如检测到 IP 被封（403 或 429 错误率上升），立即切换代理或 IP
  - 如无法切换，暂时停止服务并显示维护公告
- **长期：** 考虑付费 rotating proxy 服务（如 Bright Data、Smartproxy）

**并发控制：**
- 队列系统（Laravel Queue）管理下载任务
- 每用户同时最多 1 个下载任务
- 系统全局最多同时处理 10 个下载任务
- 超出限制的任务进入队列等待

**错误处理与恢复：**
- 下载失败自动重试 1 次
- 如重试仍失败，向用户显示友好错误信息
- 错误信息记录到日志，用于后续分析

**反滥用策略完整性评估：**
- ✅ 基本防护已覆盖（速率限制、邮箱验证、CAPTCHA、IP 限制）
- ✅ 监控和警报机制完整
- ⚠️ 仍有可能被绕过（如使用代理池 + 大量邮箱）
- ⚠️ 高级滥用场景（设备指纹、行为分析）留待 post-MVP 或必要时实施

---

### 领域需求总结

**关键约束与风险：**
1. ✅ **法律风险已接受** - 服务可能随时终止，已有基本法律保护措施
2. ⚠️ **技术依赖高** - 依赖 YouTube 和 yt-dlp，无备用方案
3. ✅ **数据隐私策略清晰** - 有限保留，平衡隐私与运营
4. ⚠️ **变现风险可控** - 混合模式降低单一收入来源风险
5. ✅ **反滥用措施完整** - MVP 已覆盖主要威胁

**实施优先级（MVP 必须完成）：**
- 🔴 **P0：** 免责声明、用户协议、bcrypt 密码、速率限制、邮箱验证、CAPTCHA
- 🟡 **P1：** IP 限制、User-Agent 检测、数据自动清理、异常监控、AdSense 集成
- 🟢 **P2（post-MVP）：** 一次性邮箱检测、账号删除功能、捐赠集成、高级监控

## Web App Specific Requirements

### Project-Type Overview

**应用类型：** Multi-Page Application (MPA)

laravel-yt-dlp 采用传统的 MPA 架构，使用 Laravel Blade 模板引擎进行服务端渲染。这个选择契合以下需求：
- **SEO 优先：** 服务端渲染天然对搜索引擎友好，确保 Google 能完整抓取内容
- **简化开发：** 无需复杂的前后端分离架构，减少开发复杂度
- **快速迭代：** Laravel 生态系统完整，适合快速 MVP 开发
- **成本效益：** 单体应用降低部署和维护成本

**核心特性：**
- 实时下载进度（WebSocket）
- SEO 优化以获取自然流量
- 移动端友好的响应式设计
- 现代浏览器支持

---

### Technical Architecture Considerations

**前端技术栈：**
- **模板引擎：** Laravel Blade
- **CSS 框架：** Tailwind CSS 或 Bootstrap（推荐 Tailwind 以减少体积）
- **JavaScript：** 原生 JS 或轻量级库（Alpine.js）用于交互增强
- **实时通信：** Laravel Echo + Laravel Reverb

**后端技术栈：**
- **框架：** Laravel 12.x
- **队列系统：** Laravel Queue (Redis)
- **缓存：** Redis
- **会话存储：** Redis 或 Database
- **WebSocket 服务器：** Laravel Reverb（Laravel 官方 WebSocket 服务器）

**架构优势：**
- 服务端渲染保证 SEO 效果
- Laravel Reverb 提供实时下载进度反馈，与 Laravel 12 深度集成
- MPA 简化状态管理，降低前端复杂度
- Laravel 生态提供完整的开箱即用功能

---

### Browser Support Matrix

**桌面浏览器支持：**

| 浏览器 | 最低版本 | 支持程度 | 备注 |
|--------|---------|---------|------|
| **Chrome** | 最新 2 个主要版本 | 完全支持 | 主要测试浏览器 |
| **Firefox** | 最新 2 个主要版本 | 完全支持 | 完全测试 |
| **Safari** | 最新 2 个主要版本 | 完全支持 | macOS 和 iOS |
| **Edge** | 最新 2 个主要版本 | 完全支持 | Chromium 版本 |
| **Internet Explorer** | 不支持 | ❌ | 已过时，不投入资源 |

**移动浏览器支持：**

| 平台 | 浏览器 | 最低版本 | 支持程度 |
|------|--------|---------|---------|
| **iOS** | Safari | iOS 14+ | 完全支持 |
| **Android** | Chrome | Android 8+ | 完全支持 |
| **Android** | Firefox | 最新版本 | 基本支持 |

**功能兼容性策略：**
- **WebSocket：** 对于不支持 WebSocket 的浏览器（极少数），降级为轮询
- **现代 JavaScript：** 使用 Babel 转译以确保兼容性
- **CSS：** 使用 Autoprefixer 自动添加浏览器前缀

**测试策略：**
- **主要测试：** Chrome (desktop), Safari (iOS), Chrome (Android)
- **次要测试：** Firefox (desktop), Edge (desktop)
- **不测试：** IE11 及更早版本

---

### Responsive Design Requirements

**断点策略：**

| 设备类型 | 屏幕宽度 | 布局策略 | 优先级 |
|---------|---------|---------|--------|
| **手机** | < 640px | 单列布局，堆叠元素 | 高 |
| **平板** | 640px - 1024px | 两列或灵活布局 | 中 |
| **桌面** | > 1024px | 多列布局，侧边栏 | 高 |
| **大屏** | > 1440px | 固定最大宽度，居中 | 低 |

**移动优先设计原则：**
- 先设计手机端体验，再扩展到桌面
- 关键操作（输入链接、开始下载）在移动端易于点击
- 避免过小的按钮和链接（最小 44x44px 点击区域）

**核心页面响应式需求：**

**1. 首页/下载页面：**
- 移动端：
  - 全宽输入框
  - 大按钮（易于点击）
  - 广告位置不阻挡核心功能
- 桌面端：
  - 居中布局（最大 1200px）
  - 侧边栏广告
  - 视频信息展示更丰富

**2. 下载进度页面：**
- 移动端：
  - 全屏进度条
  - 清晰的百分比显示
  - 简化的操作按钮
- 桌面端：
  - 居中进度卡片
  - 额外的技术信息展示

**3. 管理后台：**
- 移动端：
  - 可访问但不优化（管理员通常用桌面）
  - 堆叠式数据展示
- 桌面端：
  - 完整的仪表板布局
  - 多列数据表格
  - 图表和可视化

**图片和媒体优化：**
- 使用响应式图片（`srcset` 和 `sizes`）
- 懒加载非关键图片
- 广告脚本异步加载，不阻塞渲染

---

### Performance Targets

**页面加载性能：**

| 指标 | 目标值 | 测量工具 | 优先级 |
|------|-------|---------|--------|
| **首次内容绘制 (FCP)** | < 1.5 秒 | Lighthouse | P0 |
| **最大内容绘制 (LCP)** | < 2.5 秒 | Lighthouse | P0 |
| **首次输入延迟 (FID)** | < 100ms | Chrome DevTools | P1 |
| **累积布局偏移 (CLS)** | < 0.1 | Lighthouse | P1 |
| **Time to Interactive (TTI)** | < 3.5 秒 | Lighthouse | P1 |
| **页面总大小** | < 2MB | Network tab | P2 |

**运行时性能：**

| 场景 | 目标 | 备注 |
|------|------|------|
| **视频信息获取** | < 5 秒 | 调用 yt-dlp 获取信息 |
| **下载开始响应** | < 1 秒 | 用户点击下载到队列确认 |
| **进度更新频率** | 每 500ms | WebSocket 推送 |
| **管理后台加载** | < 2 秒 | 数据查询和渲染 |

**性能优化策略：**

**前端优化：**
- **资源压缩：** Gzip/Brotli 压缩 HTML/CSS/JS
- **代码分割：** 按页面分割 JavaScript
- **CSS 优化：** 内联关键 CSS，异步加载非关键 CSS
- **字体优化：** 使用 `font-display: swap`，考虑系统字体
- **图片优化：** WebP 格式，懒加载

**后端优化：**
- **数据库查询：** 索引优化，避免 N+1 查询
- **缓存策略：**
  - 视频信息缓存（Redis，5 分钟）
  - 页面片段缓存（Blade 缓存）
  - HTTP 缓存头（静态资源）
- **CDN：** 静态资源通过 CDN 分发（Cloudflare）
- **队列优化：** 下载任务异步处理

**监控和测量：**
- Google Lighthouse CI（持续监控）
- 真实用户监控（RUM）- 可选
- Laravel Telescope（开发环境性能分析）

---

### SEO Strategy

**SEO 重要性：**
自然搜索流量是主要获客渠道，SEO 优化直接影响业务成功。

**核心 SEO 策略：**

**1. 技术 SEO（Technical SEO）**

**服务端渲染（SSR）：**
- ✅ Laravel Blade 天然支持 SSR
- ✅ 搜索引擎爬虫可以完整抓取内容
- ✅ 无需额外配置 SSR 框架

**Meta Tags 优化：**

关键页面的 Meta 标签策略：

**首页：**
```html
<title>YouTube 视频下载工具 - 简单易用，支持字幕下载 | laravel-yt-dlp</title>
<meta name="description" content="免费 YouTube 视频下载工具，无需命令行，支持 MP4/MOV 格式，可下载字幕。简单三步，快速下载高清视频。">
<meta name="keywords" content="YouTube 下载,视频下载,yt-dlp,字幕下载,在线下载,免费下载工具">
<link rel="canonical" href="https://yourdomain.com/">
```

**Open Graph (社交分享优化)：**
```html
<meta property="og:title" content="YouTube 视频下载工具 - 简单易用">
<meta property="og:description" content="免费 YouTube 视频下载，支持字幕，无需命令行">
<meta property="og:image" content="https://yourdomain.com/og-image.jpg">
<meta property="og:url" content="https://yourdomain.com/">
<meta property="og:type" content="website">
```

**Twitter Card：**
```html
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="YouTube 视频下载工具">
<meta name="twitter:description" content="免费 YouTube 视频下载，支持字幕">
<meta name="twitter:image" content="https://yourdomain.com/twitter-image.jpg">
```

**Sitemap 和结构化数据：**

**XML Sitemap：**
- 自动生成 sitemap.xml
- 包含所有公开页面
- 提交到 Google Search Console 和 Bing Webmaster Tools

**结构化数据（Schema.org）：**

使用 JSON-LD 格式添加结构化数据：

```json
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "laravel-yt-dlp",
  "description": "YouTube 视频下载工具",
  "url": "https://yourdomain.com",
  "applicationCategory": "MultimediaApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "TWD"
  }
}
```

**2. 内容 SEO（Content SEO）**

**目标关键词：**

**主要关键词（中文市场）：**
- YouTube 下载
- YouTube 视频下载
- 在线下载 YouTube
- yt-dlp 工具
- 字幕下载

**长尾关键词：**
- YouTube 下载工具 免费
- YouTube 视频下载 字幕
- 在线 YouTube 下载 无需安装
- YouTube MP4 下载

**内容策略：**
- **首页：** 清晰的价值主张，包含主要关键词
- **FAQ 页面（post-MVP）：** 回答常见问题，覆盖长尾关键词
- **博客（可选）：** 教程和使用指南

**3. Off-Page SEO（外部 SEO）**

**链接建设策略：**
- 在相关论坛分享（Reddit、PTT、Mobile01）
- 提交到工具目录网站
- 用户自然分享和口碑传播

**社交媒体：**
- 设置 Open Graph 和 Twitter Card 优化分享效果
- 不强制社交媒体营销（非核心策略）

**4. 本地化 SEO（多语言支持 - 长期）**

如果未来支持多国语系：
- hreflang 标签标注语言版本
- 本地化 URL 结构（/zh-tw/, /en/, /ja/）
- 针对不同市场的关键词优化

**5. SEO 监控和改进**

**工具：**
- Google Search Console（必须）
- Google Analytics（必须）
- Bing Webmaster Tools（次要）

**监控指标：**
- 自然搜索流量趋势
- 关键词排名
- 点击率（CTR）
- 索引覆盖率

**持续优化：**
- 每月检查 Search Console 数据
- 根据数据调整 Meta 标签和内容
- 修复索引错误和爬虫问题

---

### Real-Time Features Implementation

**实时功能需求：**

**1. 下载进度实时更新**

**技术方案：** WebSocket (Laravel Echo + Laravel Reverb)

**实现流程：**
1. 用户点击"开始下载"
2. 后端创建下载任务，加入队列
3. 队列 Worker 处理任务，调用 yt-dlp
4. yt-dlp 每秒输出进度信息
5. 后端解析进度，通过 WebSocket 广播
6. 前端监听 WebSocket，实时更新进度条

**WebSocket 事件结构：**

```javascript
// 前端监听
Echo.private(`download.${downloadId}`)
    .listen('DownloadProgress', (e) => {
        updateProgressBar(e.percentage);
        updateStatus(e.status);
        updateETA(e.eta);
    })
    .listen('DownloadCompleted', (e) => {
        showSuccess();
        triggerDownload(e.fileUrl);
    })
    .listen('DownloadFailed', (e) => {
        showError(e.message);
    });
```

**降级方案：**
如果 WebSocket 连接失败，降级为轮询：
- 每 2 秒轮询一次进度 API
- 用户体验略差但功能可用

**2. 管理员后台实时监控**

**实时数据展示：**
- 当前下载队列长度
- 系统资源使用率（CPU、内存）
- 过去 1 小时的活跃用户数
- 实时下载成功/失败统计

**技术方案：**
- 后端每 5 秒广播统计数据到管理员频道
- 前端监听并更新仪表板数字

**WebSocket 频道：**
```javascript
// 管理员专用频道
Echo.private('admin.dashboard')
    .listen('SystemStats', (e) => {
        updateDashboard(e.stats);
    });
```

**Laravel Reverb 优势：**
- Laravel 官方 WebSocket 服务器，与 Laravel 12 深度集成
- 开源免费，自托管
- 简单配置，无需额外的第三方依赖
- 性能优秀，适合中小规模应用

**Laravel Reverb 部署：**
- 使用 Docker 容器化 Reverb
- 与主应用部署在同一 VPS
- Nginx 反向代理 WebSocket 连接

---

### Accessibility Level

**无障碍访问策略：**

采用**最低限度合规策略**：

**基本要求（不刻意优化，但避免明显问题）：**
- ✅ 语义化 HTML（使用正确的标签：`<button>`, `<form>`, `<nav>`）
- ✅ 表单输入框有对应的 `<label>`
- ✅ 图片有 `alt` 文本（即使是空字符串）
- ✅ 链接和按钮有描述性文本

**不投入资源的领域：**
- ❌ WCAG AA/AAA 合规性测试
- ❌ 键盘导航优化（超出基本功能）
- ❌ 屏幕阅读器专门优化
- ❌ 颜色对比度测试和调整
- ❌ ARIA 属性广泛使用

**实际影响：**
- 大多数用户不会受影响
- 视障用户可能遇到使用障碍
- 这是接受的权衡（MVP 优先功能完整性）

**未来考虑：**
- 如果有用户反馈无障碍问题，再评估是否投入
- 如果法规要求，再补充

---

### Web App 技术需求总结

**技术栈概览：**
- **架构：** MPA (Laravel Blade)
- **后端框架：** Laravel 12.x
- **浏览器：** 现代浏览器 + 移动端
- **SEO：** 高优先级（SSR, Meta, Sitemap）
- **实时功能：** WebSocket (Laravel Reverb)
- **无障碍：** 最低限度（不优化）

**关键技术决策：**
1. ✅ MPA 架构简化开发，天然 SEO 友好
2. ✅ Laravel Reverb 提供实时进度反馈，与 Laravel 12 深度集成
3. ✅ SEO 优化确保自然流量获取
4. ✅ 响应式设计支持移动和桌面用户
5. ✅ 性能优化保证快速加载

**实施优先级：**
- 🔴 **P0（MVP 必须）：** MPA 基础架构、SEO Meta 标签、Laravel Reverb 下载进度、响应式布局
- 🟡 **P1（MVP 推荐）：** Sitemap、结构化数据、性能优化、管理后台实时监控
- 🟢 **P2（post-MVP）：** 高级 SEO（博客、FAQ）、WebSocket 降级轮询、多语言支持

## Project Scoping & Phased Development

本节聚焦交付节奏与风险，功能细节已在 Product Scope 中列出。

### MVP 策略与哲学

**项目策略：**
本项目采用**三阶段渐进式上线策略**，优先解决个人需求，再扩展到公开服务：

**Phase 1：** 本地 MVP（个人使用）
**Phase 2：** Production Launch（公开上线，含管理和防护）
**Phase 3：** Post-Launch Growth（流量增长和功能增强）

**核心原则：**
- **自用优先：** Phase 1 专注核心下载功能，满足个人需求
- **安全上线：** Phase 2 添加管理后台和反滥用措施，确保可控
- **持续增长：** Phase 3 通过 SEO 和功能增强吸引更多用户

---

### Phase 1: 本地 MVP（个人使用）

**目标：** 解决个人 YouTube 视频下载痛点，本地环境运行

**核心用户旅程支持：**
- jyu（管理员）- 个人使用场景
  - 访问工具 → 输入 YouTube 链接 → 选择格式和字幕 → 实时下载进度 → 下载完成
  - 无广告、无配额限制

**必须完成的功能：**

1. **视频下载核心流程**
   - YouTube 链接输入和验证
   - 视频信息展示（标题、时长、文件大小）
   - 视频格式选择（MP4 / MOV）
   - 最高画质 + 最好音质自动选择

2. **字幕功能**
   - 可选字幕下载
   - 字幕语言选择

3. **下载体验**
   - 实时下载进度条（Laravel Reverb WebSocket）
   - 流式传输（不在服务器存储视频）

4. **基础用户系统**
   - 管理员账号登录
   - 无广告、无配额限制（管理员特权）

5. **错误处理**
   - 链接无效提示
   - 不支持视频类型提示
   - 网络异常处理

6. **技术基础设施**
   - Docker 开发环境
   - Laravel 12.x 框架基础
   - yt-dlp 集成
   - Laravel Reverb（WebSocket）
   - 队列系统（Laravel Queue + Redis）

**Phase 1 不包含：**
- ❌ 管理后台
- ❌ 反滥用措施
- ❌ 用户注册功能
- ❌ 速率限制
- ❌ 广告集成
- ❌ SEO 优化

**Phase 1 完成标准：**
- ✅ jyu 可以在本地使用工具下载 YouTube 视频
- ✅ 下载成功率 ≥ 95%
- ✅ 视频信息响应 < 5 秒
- ✅ 支持字幕下载和格式选择

---

### Phase 2: Production Launch（公开上线）

**目标：** 上线到互联网，开始变现，同时确保系统可控和安全

**新增用户旅程支持：**
- 小陈（匿名用户）- 首次使用体验
- Lisa（注册用户）- 日常使用和配额管理
- jyu（管理员）- 运营维护和滥用处理

**Phase 2 新增功能（必须）：**

1. **完整用户系统**
   - 用户注册/登录
   - 邮箱验证（Email Verification）- 必须完成才能使用
   - 速率限制：
     - 匿名用户：每天 3 部视频（可动态调整）
     - 注册用户：每小时 5 部、每天 10 部
   - 管理员白名单（无广告、无配额限制）

2. **管理后台（必须完成才能上线）**

   **仪表板：**
   - 今日统计：下载次数、新注册用户、活跃用户
   - 系统状态：CPU、内存、下载队列、yt-dlp 版本
   - 收入预估：广告展示次数、预估收入

   **用户管理：**
   - 用户详情查看（下载历史、IP、User-Agent）
   - 封锁用户账号
   - 封锁 IP（带时限：24 小时临时 / 永久）

   **安全管理：**
   - 异常行为警报（邮件通知）
   - 滥用检测
   - 非浏览器请求拦截开关

   **运营工具：**
   - 临时开放下载配额（如系统维护后补偿）
   - 系统公告发布
   - 错误日志查看

3. **反滥用措施（必须完成才能上线）**

   **P0 级别（必须）：**
   - 速率限制（Rate Limiting）
   - 邮箱验证（Email Verification）
   - IP 关联限制（24 小时内同一 IP 最多 3 个账号）
   - CAPTCHA 验证（注册时必须）
   - User-Agent 检测（阻止非浏览器请求）

   **P1 级别（推荐）：**
   - 异常流量监控
   - 自动 IP 封锁（5 次 CAPTCHA 失败）
   - 邮件警报机制

4. **变现系统**
   - Google AdSense 广告集成
   - 广告位置：顶部横幅、侧边栏、下载页面
   - 显示规则：
     - 匿名用户：显示广告
     - 注册用户：显示广告（但可以比匿名用户少一点）
     - 管理员：无广告

5. **数据管理**
   - 数据保留策略（自动清理）
   - 用户协议和免责声明
   - 基本安全措施（HTTPS、CSRF、XSS 防护）

**Phase 2 可选（可以上线后再加）：**
- ⚠️ SEO 优化（Meta tags、Sitemap、结构化数据）
- ⚠️ 实时后台监控（WebSocket 统计更新）

**Phase 2 完成标准：**
- ✅ 所有 Phase 1 功能稳定运行
- ✅ 管理后台完整可用
- ✅ 反滥用措施有效运作
- ✅ AdSense 集成成功（或备用广告网络）
- ✅ 可以安全地让陌生人使用，不会被滥用
- ✅ jyu 可以通过管理后台监控和管理用户

---

### Phase 3: Post-Launch Growth（增长功能）

**目标：** 提升自然流量、用户粘性和收益

**Phase 3 功能（按优先级排序）：**

**P1：SEO 优化（如果 Phase 2 未完成）**
- Meta tags 优化
- XML Sitemap 生成
- 结构化数据（Schema.org）
- Google Search Console 和 Analytics 集成
- 关键词优化和内容策略

**P2：用户体验增强**
- 下载历史记录
- 用户统计仪表板（个人使用情况和配额）
- 下载队列管理
- WebSocket 降级轮询（兼容性）

**P3：功能扩展**
- 批量下载（一次提交多个链接）
- 更多格式支持（WebM、MKV）
- 下载速度优化
- 一次性邮箱检测
- 账号删除功能

**P4：增长和变现优化**
- 备用广告网络集成（如 AdSense 失败）
- 可选捐赠功能（Buy Me a Coffee）
- 动态配额调整系统（根据使用量自动调节匿名用户配额）
- 高级 SEO（博客、FAQ 页面）

**P5：长期愿景**
- AI 内容分析集成
- 云存储集成（Google Drive、Dropbox）
- 播放列表批量下载
- 音频提取（MP3、AAC）
- 多语言支持

---

### 风险缓解策略

**技术风险：**

**风险 1：YouTube 封锁 yt-dlp**
- **影响：** 致命 - 可能导致项目完全无法使用
- **概率：** 中等 - YouTube 可能更新反爬虫机制
- **缓解策略：**
  - 监控下载失败率（管理后台）
  - 及时更新 yt-dlp 版本
  - 使用 proxy 池或 VPN 分散请求
- **应急计划：**
  - 尝试寻找替代方案
  - 如无法解决，暂时关闭服务
  - **风险接受：** 如果 YouTube 大规模封杀，接受项目中止

**风险 2：YouTube 封锁服务器 IP**
- **影响：** 高 - 服务中断
- **概率：** 中等
- **缓解策略：**
  - 从一开始使用 proxy 或 VPN
  - 准备备用 IP 或 VPS
- **应急计划：** 更换 VPS 或使用 rotating proxy 服务

**市场风险：**

**风险 3：AdSense 拒绝或封号**
- **影响：** 高 - 影响变现
- **概率：** 中高 - YouTube 下载工具在灰色地带
- **缓解策略：**
  - 申请时如实描述产品功能
  - 准备备用广告网络（Media.net、PropellerAds）
- **应急计划：**
  - 立即切换到备用广告网络
  - 如所有广告平台都拒绝，考虑捐赠模式
  - 如捐赠不可行，考虑关闭项目
  - **风险接受：** 不考虑向用户收费（避免服务保证责任）

**风险 4：用户注册率低**
- **影响：** 中等 - 影响用户留存和收益
- **概率：** 中等
- **缓解策略：**
  - 动态调整匿名用户配额（根据流量和资源使用情况）
  - 清晰展示注册价值（更高配额）
- **应急计划：**
  - 提高匿名用户配额吸引流量
  - 或降低配额促进注册
  - 后续可开发自动调整系统（Phase 3）

**风险 5：广告干扰影响用户留存**
- **影响：** 低 - 可能影响用户体验
- **概率：** 低
- **缓解策略：**
  - 免费服务，广告是合理的
  - 注册用户可以减少广告展示
- **风险接受：** 免费就要看广告，这是行业标准

**资源风险：**

**风险 6：开发时间超出预期**
- **影响：** 中等 - 延迟上线
- **概率：** 中等
- **缓解策略：**
  - Phase 1 和 Phase 2 分离，优先完成 Phase 1
  - Phase 2 的功能可以逐步上线（先管理后台，再反滥用）
- **应急计划：**
  - 削减 Phase 3 功能
  - Phase 2 的非关键功能可以延后（如 SEO）

**风险 7：服务器成本超出预期**
- **影响：** 中等 - 影响净利润
- **概率：** 低
- **缓解策略：**
  - 并发控制（系统最多 10 个同时下载）
  - 队列系统限制资源使用
- **应急计划：**
  - 降低用户配额
  - 提高广告展示密度
  - 如成本无法覆盖，考虑关闭

---

### 项目范围总结

**Phase 1 - 本地 MVP：**
- 核心下载功能 + 基础用户系统
- 完成标准：个人可用
- 预计工作量：中等

**Phase 2 - Production Launch（Launch Blocker）：**
- Phase 1 + 管理后台 + 反滥用 + 变现
- 完成标准：可安全公开运营
- 预计工作量：大

**Phase 3 - Post-Launch Growth：**
- SEO + 增长功能 + 长期愿景
- 完成标准：持续迭代
- 预计工作量：持续投入

## Functional Requirements

### 用户与角色管理

- FR1: 访客可以匿名使用下载功能直到达到匿名配额上限
- FR2: 访客可以注册账号
- FR3: 注册用户可以登录并使用注册用户配额
- FR4: 系统能区分匿名用户、注册用户、管理员三种角色
- FR5: 管理员账号可获得无广告、无限配额的特权

### 链接与视频信息

- FR6: 用户可以提交 YouTube 链接进行解析
- FR7: 系统可以验证链接有效性并返回错误提示
- FR8: 系统可以展示视频标题、时长、文件大小
- FR9: 用户可以选择视频格式（例如 MP4、MOV）
- FR10: 系统可以自动选择最佳画质与音质组合

### 字幕能力

- FR11: 用户可以选择是否下载字幕
- FR12: 用户可以选择字幕语言
- FR13: 系统可以在下载完成时提供字幕文件

### 下载执行与交付

- FR14: 用户可以启动下载
- FR15: 系统可以为用户提供下载进度更新
- FR16: 下载完成后系统能交付文件给用户
- FR17: 系统能在下载失败时提供原因提示

### 配额与速率限制

- FR18: 系统能对匿名用户施加下载配额限制
- FR19: 系统能对注册用户施加每小时与每日配额限制
- FR20: 系统能显示当前用户剩余配额
- FR21: 系统能在达到配额时阻止下载并提示

### 广告与变现

- FR22: 系统可对非管理员用户展示广告
- FR23: 系统可对管理员隐藏广告

### 管理后台与运营

- FR24: 管理员可以查看下载、用户、活跃度统计
- FR25: 管理员可以查看系统运行状态
- FR26: 管理员可以查看收入或广告展示统计
- FR27: 管理员可以查看错误或失败记录

### 用户与滥用治理

- FR28: 管理员可以查看用户详情（含下载记录、IP、UA）
- FR29: 管理员可以封锁用户账号
- FR30: 管理员可以封锁 IP 并设置期限
- FR31: 系统可以检测非浏览器请求并阻止
- FR32: 系统可以识别异常下载行为并告警

### 合规与条款

- FR33: 系统可以展示免责声明与使用条款
- FR34: 系统可以要求用户同意使用条款后使用服务

### 维护与版本管理

- FR35: 管理员可以查看当前 yt-dlp 版本信息
- FR36: 管理员可以发布系统公告

### 数据保留与清理

- FR37: 系统可以按配置周期清理下载记录
- FR38: 系统可以按配置周期清理错误日志
- FR39: 系统可以按配置周期清理 IP 记录

## Non-Functional Requirements

### Performance

- NFR1: 视频信息展示在提交链接后 ≤ 5 秒完成
- NFR2: 下载开始响应在用户点击后 ≤ 1 秒确认
- NFR3: 下载进度更新频率 ≥ 每 500ms
- NFR4: 平均下载完成时间（从提交到完成）≤ 3 分钟（常见视频）

### Reliability

- NFR5: 系统整体下载成功率 ≥ 95%
- NFR6: 系统可用性 ≥ 99%（计划维护除外）

### Security & Abuse Prevention

- NFR7: 账号密码使用安全哈希（bcrypt）存储
- NFR8: 非浏览器请求默认拦截并可配置
- NFR9: 触发异常行为时可自动告警
- NFR10: 所有用户交互必须通过 HTTPS

### Scalability

- NFR11: 系统同时处理下载任务 ≤ 10
- NFR12: 单用户并发下载 ≤ 1

### Compliance & Data Retention

- NFR13: 下载记录按策略自动清理（匿名 24h、注册 90d）
- NFR14: IP 记录保留 30 天（封锁期间例外）
- NFR15: 错误日志保留 30 天
- NFR16: 注册必须确认使用条款与免责声明
